meta {
  name: Test 2.3 - Upload Large Directory
  type: http
  seq: 1
}

post {
  url: {{baseUrl}}/directory/upload
  body: json
  auth: none
}

headers {
  userId: 3129426
  transactionId: 6249213
}

body:json {
  {
    "sourcePath": "C:/Users/oi926e/Downloads/LargeTestDir",
    "destinationBucket": "{{testBucket}}",
    "destinationPrefix": "STAGE/INGRESS"
  }
}

settings {
  encodeUrl: true
}

tests {
  // Basic response integrity
  test("Response has expected top-level fields", function() {
    expect(res.status).to.equal(200);
    expect(res.body).to.be.an('object');
    expect(res.body).to.have.property('transactionId');
    expect(res.body).to.have.property('status');
    expect(res.body).to.have.property('data');
  });

  // Data payload checks
  test("Response data structure is correct", function() {
    expect(res.body.data).to.be.an('object');
    expect(res.body.data).to.have.property('destinationBucket');
    expect(res.body.data).to.have.property('destinationPrefix');
    expect(res.body.data).to.have.property('fileCount');
    expect(res.body.data).to.have.property('uploadedFiles');
  });

  // Business validations
  test("Files were uploaded", function() {
    expect(res.body.data.fileCount).to.be.greaterThan(0);
    expect(res.body.data.uploadedFiles).to.be.an('array');
    expect(res.body.data.uploadedFiles.length).to.equal(res.body.data.fileCount);
  });
}